<?php
require_once('../../../autoload.php');

if($lib->checkCompleteArgument(['unique_id'],$dataComing)){
	if($func->check_permission_core($payload,'mobileadmin','constanttypeloan')){
		$arrayGroup = array();
		$arrayLoanCheckGrp = array();
		$fetchLoanTypeCheck = $conmysql->prepare("SELECT LOANTYPE_CODE,IS_CREDITLOAN,IS_LOANREQUEST,IS_QRPAYMENT FROM gcconstanttypeloan");
		$fetchLoanTypeCheck->execute();
		while($rowLoantypeCheck = $fetchLoanTypeCheck->fetch(PDO::FETCH_ASSOC)){
			$arrayLoanCheck = $rowLoantypeCheck;
			$arrayLoanCheckGrp[] = $arrayLoanCheck;
		}
		$fetchLoantype = $conoracle->prepare("SELECT L_TYPE_CODE as LOANTYPE_CODE,L_TYPE_NAME as LOANTYPE_DESC FROM LOAN_M_TYPE_NAME ORDER BY L_TYPE_CODE ASC");
		$fetchLoantype->execute();
		while($rowLoantype = $fetchLoantype->fetch(PDO::FETCH_ASSOC)){
			$arrayLoantype = array();
			if(array_search($rowLoantype["LOANTYPE_CODE"],array_column($arrayLoanCheckGrp,'LOANTYPE_CODE')) === False){
				$arrayLoantype["IS_CREDITLOAN"] = "0";
				$arrayLoantype["IS_LOANREQUEST"] = "0";
				$arrayLoantype["IS_QRPAYMENT"] = "0";
				//$arrayLoantype["LOANTYPE_ALIAS_NAME"] = null;
			}else{
				$arrayLoantype["IS_CREDITLOAN"] = $arrayLoanCheckGrp[array_search($rowLoantype["LOANTYPE_CODE"],array_column($arrayLoanCheckGrp,'LOANTYPE_CODE'))]["IS_CREDITLOAN"];
				$arrayLoantype["IS_LOANREQUEST"] = $arrayLoanCheckGrp[array_search($rowLoantype["LOANTYPE_CODE"],array_column($arrayLoanCheckGrp,'LOANTYPE_CODE'))]["IS_LOANREQUEST"];
				$arrayLoantype["IS_QRPAYMENT"] = $arrayLoanCheckGrp[array_search($rowLoantype["LOANTYPE_CODE"],array_column($arrayLoanCheckGrp,'LOANTYPE_CODE'))]["IS_QRPAYMENT"];
				//$arrayLoantype["LOANTYPE_ALIAS_NAME"] = $arrayLoanCheckGrp[array_search($rowLoantype["LOANTYPE_CODE"],array_column($arrayLoanCheckGrp,'LOANTYPE_CODE'))]["LOANTYPE_ALIAS_NAME"];
			}
			$arrayLoantype["LOANTYPE_CODE"] = $rowLoantype["LOANTYPE_CODE"];
			$arrayLoantype["LOANTYPE_DESC"] = $rowLoantype["LOANTYPE_DESC"];
			$arrayGroup[] = $rowLoantype;
		}
		$arrayResult["arrayLoanCheckGrp"] = $arrayGroup;
		$arrayResult["LOAN_TYPE"] = $arrayGroup;
		$arrayResult["IS_ESTIMATE"] = FALSE; //เปิด checkbox ประมาณการสิทธิ์กู้
		$arrayResult["RESULT"] = TRUE;
		require_once('../../../../include/exit_footer.php');
	}else{
		$arrayResult['RESULT'] = FALSE;
		http_response_code(403);
		require_once('../../../../include/exit_footer.php');
		
	}
}else{
	$arrayResult['RESULT'] = FALSE;
	http_response_code(400);
	require_once('../../../../include/exit_footer.php');
	
}
?>